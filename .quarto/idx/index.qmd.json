{"title":"Nexora: 4-Year Portfolio Selection & Schedule","markdown":{"yaml":{"title":"Nexora: 4-Year Portfolio Selection & Schedule","author":"Oleksandr Skytchenko","date":"today","format":{"html":{"theme":{"light":"flatly","dark":"darkly"},"toc":true,"toc-title":"On this page","toc-depth":3,"number-sections":false,"code-fold":true,"code-tools":false,"smooth-scroll":true,"df-print":"paged","page-layout":"full","fig-cap-location":"margin","fig-align":"center","fig-width":9,"fig-height":6,"dpi":220,"anchor-sections":true,"css":"assets/bloomberg.css"}},"execute":{"echo":false,"warning":false,"message":false,"cache":false}},"headingText":"=== SETUP ===","containsRefs":false,"markdown":"\n\n\n\n```{r}\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(knitr)\nlibrary(ggrepel)\nlibrary(kableExtra)\n\n\n# Load data ---------------------------------------------------------------\ncsv_path <- \"projects.csv\"\nstopifnot(file.exists(csv_path))\n\nprojects <- read_csv(csv_path, show_col_types = FALSE)\nnames(projects) <- tolower(names(projects))\n\n# Verify required columns\nreq <- c(\"id\",\"name\",\"npv_k\",\"strategic_value\",\n         \"sustainability_tco2\",\"workforce_fte\",\"motivation\",\"duration_years\")\nstopifnot(all(req %in% names(projects)))\n\n# Rename duration_years -> duration_months (task values are in months)\nprojects <- projects %>%\n  rename(duration_months = duration_years) %>%\n  mutate(across(c(npv_k, strategic_value, sustainability_tco2,\n                  workforce_fte, motivation, duration_months), as.numeric))\n\n# === FUNCTIONS ===\n\n# --- Scoring -------------------------------------------------------------\nscore_projects <- function(df, mode = c(\"balanced\",\"growth\",\"responsible\")) {\n  mode <- match.arg(mode)\n  rng <- function(x) (x - min(x)) / (max(x) - min(x) + 1e-9)\n  x <- df %>%\n    mutate(\n      npv_n = rng(npv_k),\n      sv_n  = rng(strategic_value),\n      sus_n = rng(sustainability_tco2),\n      mot_n = rng(motivation),\n      fte_n = rng(workforce_fte)\n    )\n  x$score <- switch(\n    mode,\n    balanced    = 0.33 * x$npv_n + 0.33 * x$sv_n + 0.34 * x$sus_n + 0.05 * x$mot_n - 0.05 * x$fte_n,\n    growth      = 0.65 * x$npv_n + 0.20 * x$sus_n + 0.15 * x$sv_n + 0.02 * x$mot_n - 0.02 * x$fte_n,\n    responsible = 0.55 * x$sus_n + 0.25 * x$mot_n + 0.20 * x$sv_n - 0.05 * x$fte_n + 0.05 * x$npv_n\n  )\n  x %>% arrange(desc(score))\n}\n\n# --- Selection (greedy) --------------------------------------------------\nbuild_portfolio <- function(df_scored, min_npv, min_sv, cap_total_fte = NA) {\n  cand <- df_scored %>% arrange(desc(score)) %>% mutate(selected = FALSE)\n  tot <- c(npv=0, sv=0, sus=0, fte=0)\n\n  for (i in seq_len(nrow(cand))) {\n    fits <- is.na(cap_total_fte) || (tot[\"fte\"] + cand$workforce_fte[i] <= cap_total_fte)\n    if (fits) {\n      cand$selected[i] <- TRUE\n      tot[\"npv\"] <- tot[\"npv\"] + cand$npv_k[i]\n      tot[\"sv\"]  <- tot[\"sv\"]  + cand$strategic_value[i]\n      tot[\"sus\"] <- tot[\"sus\"] + cand$sustainability_tco2[i]\n      tot[\"fte\"] <- tot[\"fte\"] + cand$workforce_fte[i]\n    }\n  }\n\n  list(\n    selection = cand %>% filter(selected),\n    totals = list(\n      npv = sum(cand$npv_k[cand$selected]),\n      sv  = sum(cand$strategic_value[cand$selected]),\n      sus = sum(cand$sustainability_tco2[cand$selected]),\n      fte = sum(cand$workforce_fte[cand$selected])\n    )\n  )\n}\n\n# --- Balanced 48-Month Scheduler: smooths Strategic Intensity & FTE ---\nschedule_48m <- function(sel_df, cap_monthly_fte = NA, w_sv = 0.7, w_fte = 0.3) {\n  if (nrow(sel_df) == 0) return(sel_df %>% mutate(start_month = integer(), end_month = integer()))\n  # work copies\n  plan <- sel_df %>%\n    arrange(desc(score)) %>%            # higher score first\n    mutate(start_month = NA_integer_, end_month = NA_integer_)\n  used_fte <- rep(0, 48)\n  used_sv  <- rep(0, 48)\n\n  for (i in seq_len(nrow(plan))) {\n    dur <- max(1, round(plan$duration_months[i]))\n    fte <- plan$workforce_fte[i]\n    sv  <- plan$strategic_value[i]\n\n    # Try all feasible start months; pick the one that best smooths (min variance)\n    best_cost <- Inf\n    best_start <- NA_integer_\n\n    for (start in 1:(48 - dur + 1)) {\n      idx <- start:(start + dur - 1)\n\n      # capacity feasibility\n      feasible <- all(is.na(cap_monthly_fte) | (used_fte[idx] + fte) <= cap_monthly_fte)\n      if (!feasible) next\n\n      # simulate placement\n      new_fte <- used_fte; new_fte[idx] <- new_fte[idx] + fte\n      new_sv  <- used_sv;  new_sv[idx]  <- new_sv[idx]  + sv\n\n      # objective: weighted sum of monthly variability\n      cost <- w_sv * stats::sd(new_sv) + w_fte * stats::sd(new_fte)\n\n      if (cost < best_cost) { best_cost <- cost; best_start <- start }\n    }\n\n    # if nothing feasible (rare), push to the end within 48m\n    if (is.na(best_start)) best_start <- max(1, 49 - dur)\n\n    # commit placement\n    idx <- best_start:(best_start + dur - 1)\n    used_fte[idx] <- used_fte[idx] + fte\n    used_sv[idx]  <- used_sv[idx]  + sv\n    plan$start_month[i] <- best_start\n    plan$end_month[i]   <- best_start + dur - 1\n  }\n\n  plan\n}\n\n\n# === RUN MODEL ===\nmode      <- \"balanced\"        # choose: balanced | growth | responsible\nmin_npv   <- 50000             # minimum NPV threshold (k€)\nmin_sv    <- 80                # minimum Strategic Value\ncap_total <- 200               # total FTE capacity\ncap_month <- NA                # monthly cap (optional)\n\nscored    <- score_projects(projects, mode)\npicked    <- build_portfolio(scored, min_npv, min_sv, cap_total)\nselected  <- picked$selection\ntotals    <- picked$totals\n\n\nmeets  <- (totals$npv >= min_npv) & (totals$sv >= min_sv)\nstatus <- if (meets) \"Meets thresholds\" else \"⚠️ Below thresholds\"\n\nif (FALSE) {\ncat(\"**Strategy:**\", mode, \"\\n\",\n    \"**Min NPV (k€):**\", min_npv, \"\\n\",\n    \"**Min Strategic Value:**\", min_sv, \"\\n\",\n    \"**Total FTE cap:**\", ifelse(is.na(cap_total), \"∞\", cap_total), \"\\n\",\n    \"**Monthly FTE cap:**\", ifelse(is.na(cap_month), \"—\", cap_month), \"\\n\",\n    \"**Status:**\", status, \"\\n\\n\")\n\nkable(\n  tibble::tibble(\n    Metric = c(\"NPV (k€)\",\"Strategic Value (sum)\",\n               \"Sustainability (tCO2e/yr)\",\"FTE (sum)\"),\n    Value  = c(totals$npv, totals$sv, totals$sus, totals$fte)\n  ),\n  caption = \"Portfolio totals\"\n)\n}\n# --- PLAN A: lift Strategic Value to >= min_sv ---\nif (totals$sv < min_sv) {\n  fix_drop <- intersect(c(20), selected$id)\n  fix_add  <- setdiff(intersect(c(2, 4), scored$id), selected$id)\n\n  selected <- selected %>%\n    dplyr::filter(!id %in% fix_drop) %>%\n    dplyr::bind_rows(scored %>% dplyr::filter(id %in% fix_add)) %>%\n    dplyr::distinct(id, .keep_all = TRUE) %>%\n    dplyr::arrange(dplyr::desc(score))\n\n  totals <- list(\n    npv = sum(selected$npv_k, na.rm = TRUE),\n    sv  = sum(selected$strategic_value, na.rm = TRUE),\n    sus = sum(selected$sustainability_tco2, na.rm = TRUE),\n    fte = sum(selected$workforce_fte, na.rm = TRUE)\n  )\n\n  # old text output disabled (kept for debugging if needed)\n  if (FALSE) {\n    cat(\"\\n--- After Scenario A (applied) ---\\n\",\n        \"Selected projects: \", nrow(selected), \"\\n\",\n        \"Total NPV (k€):   \", totals$npv, \" | target ≥ \", min_npv, \"\\n\",\n        \"Strategic Value Σ:\", totals$sv,  \" | target ≥ \", min_sv,  \"\\n\",\n        \"Sustainability Σ: \", totals$sus, \" (tCO2e/yr)\\n\",\n        \"Total FTE Σ:      \", totals$fte, \" | cap = \", cap_total, \"\\n\\n\", sep = \"\")\n  }\n}  # <-- this was missing\n\n\n# Build the table sources AFTER Scenario A (so they stay in sync)\nsel_tbl <- selected %>%\n  dplyr::select(\n    id, name, npv_k, strategic_value, sustainability_tco2,\n    workforce_fte, motivation, duration_months, score\n  )\n\ntot_row <- tibble::tibble(\n  id = NA_integer_,\n  name = \"TOTAL\",\n  npv_k = sum(selected$npv_k, na.rm = TRUE),\n  strategic_value = sum(selected$strategic_value, na.rm = TRUE),\n  sustainability_tco2 = sum(selected$sustainability_tco2, na.rm = TRUE),\n  workforce_fte = sum(selected$workforce_fte, na.rm = TRUE),\n  motivation = NA_real_,\n  duration_months = NA_real_,\n  score = NA_real_\n)\n\n# Create the 48-month schedule BEFORE any tables/plots that use it\nscheduled <- schedule_48m(selected, cap_month)\n# Create (or re-create) the 48-month schedule BEFORE any tables/plots\nif (!exists(\"scheduled\")) scheduled <- schedule_48m(selected, cap_month)\n\n\n# === Scenario summary table (nice formatting; kableExtra-safe) ===\npass_npv <- totals$npv >= min_npv\npass_sv  <- totals$sv  >= min_sv\npass_fte <- is.na(cap_total) || totals$fte <= cap_total\n\nscenario_tbl <- tibble::tibble(\n  Metric = c(\n    \"Selected projects\",\n    \"Total NPV (k€)\",\n    \"Strategic Value Σ\",\n    \"Sustainability Σ (tCO₂e/yr)\",\n    \"Total FTE Σ\"\n  ),\n  Value = c(\n    nrow(selected),\n    scales::comma(totals$npv),\n    scales::comma(totals$sv),\n    scales::comma(totals$sus),\n    scales::comma(totals$fte)\n  ),\n  Target = c(\n    \"—\",\n    paste0(\"≥ \", scales::comma(min_npv)),\n    paste0(\"≥ \", min_sv),\n    \"—\",\n    if (!is.na(cap_total)) paste0(\"≤ \", scales::comma(cap_total)) else \"—\"\n  ),\n  Status = c(\n    \"—\",\n    if (pass_npv) \"Meets\" else \"⚠️ Below\",\n    if (pass_sv)  \"Meets\" else \"⚠️ Below\",\n    \"—\",\n    if (pass_fte) \"Within\" else \"⚠️ Exceeds\"\n  )\n)\n\nif (requireNamespace(\"kableExtra\", quietly = TRUE)) {\n  badge_css <- \"padding:2px 8px;border-radius:12px;display:inline-block;\"\n\n  scenario_tbl_print <- scenario_tbl %>%\n    dplyr::mutate(\n      Status = dplyr::case_when(\n        Metric %in% c(\"Total NPV (k€)\", \"Strategic Value Σ\", \"Total FTE Σ\") & grepl(\"✅\", Status) ~\n          kableExtra::cell_spec(Status, \"html\", color = \"white\", bold = TRUE,\n                                background = \"#16a34a\", extra_css = badge_css),\n        Metric %in% c(\"Total NPV (k€)\", \"Strategic Value Σ\", \"Total FTE Σ\") & grepl(\"⚠️\", Status) ~\n          kableExtra::cell_spec(Status, \"html\", color = \"white\", bold = TRUE,\n                                background = \"#dc2626\", extra_css = badge_css),\n        TRUE ~ Status\n      )\n    )\n\n  scenario_tbl_print %>%\n    kableExtra::kable(\n      format  = \"html\",\n      caption = \"Scenario Summary — After Scenario A (applied)\",\n      align   = c(\"l\",\"r\",\"c\",\"c\"),\n      escape  = FALSE\n    ) %>%\n    kableExtra::kable_styling(\n      full_width = FALSE,\n      bootstrap_options = c(\"striped\",\"condensed\")\n    ) %>%\n    kableExtra::column_spec(1, bold = TRUE) %>%\n    kableExtra::column_spec(2, width = \"8em\", monospace = TRUE) %>%\n    kableExtra::column_spec(3, width = \"8em\", monospace = TRUE) %>%\n    kableExtra::column_spec(4, width = \"7em\") %>%\n    kableExtra::row_spec(1, background = \"#F8FAFC\")\n} else {\n  knitr::kable(\n    scenario_tbl,\n    caption = \"Scenario Summary — After Scenario A (applied)\",\n    align   = c(\"l\",\"r\",\"c\",\"c\")\n  )\n}\n\n\n\n\n# === TABLES (selected with TOTAL row + balanced 48-month schedule) ===\nlibrary(scales)\nlibrary(kableExtra)\n\n# 1 Format the data (keep this part unchanged)\nsel_tbl_fmt <- dplyr::bind_rows(sel_tbl, tot_row) %>%\n  dplyr::mutate(\n    npv_k               = scales::label_comma(accuracy = 1)(as.numeric(npv_k)),\n    strategic_value     = as.character(strategic_value),\n    sustainability_tco2 = scales::label_comma(accuracy = 1)(as.numeric(sustainability_tco2)),\n    workforce_fte       = scales::label_comma(accuracy = 1)(as.numeric(workforce_fte)),\n    motivation          = dplyr::if_else(is.na(motivation), \"\", as.character(round(motivation, 2))),\n    duration_months     = dplyr::if_else(is.na(duration_months), \"\", as.character(round(duration_months, 0))),\n    score               = dplyr::if_else(is.na(score), \"\", as.character(round(score, 3)))\n  )\n\nif (exists(\"scheduled\") && is.data.frame(scheduled) && nrow(scheduled) > 0) {\n  scheduled_fmt <- scheduled %>%\n    dplyr::arrange(start_month, dplyr::desc(score)) %>%\n    dplyr::select(id, name, strategic_value, workforce_fte,\n                  duration_months, start_month, end_month) %>%\n    dplyr::mutate(\n      workforce_fte   = scales::label_comma(accuracy = 1)(as.numeric(workforce_fte)),\n      duration_months = round(as.numeric(duration_months), 0),\n      start_month     = round(as.numeric(start_month), 0),\n      end_month       = round(as.numeric(end_month), 0)\n    )\n} else {\n  scheduled_fmt <- tibble::tibble(\n    id=integer(), name=character(), strategic_value=numeric(),\n    workforce_fte=numeric(), duration_months=integer(),\n    start_month=integer(), end_month=integer()\n  )\n}\n\n\n# 2 Then render the formatted tables (new styling section)\n# --- Selected portfolio (with TOTAL row) ---\nif (requireNamespace(\"kableExtra\", quietly = TRUE)) {\n  sel_tbl_fmt %>%\n    kableExtra::kable(\n      format  = \"html\",\n      caption = \"Selected portfolio (within FTE cap)\",\n      align   = c(\"c\",\"l\",\"r\",\"r\",\"r\",\"r\",\"r\",\"r\",\"r\"),\n      escape  = FALSE\n    ) %>%\n    kableExtra::kable_styling(\n      full_width = FALSE,\n      bootstrap_options = c(\"striped\",\"hover\",\"condensed\")\n    ) %>%\n    kableExtra::row_spec(nrow(sel_tbl_fmt), bold = TRUE)\n} else {\n  knitr::kable(\n    sel_tbl_fmt,\n    caption = \"Selected portfolio (within FTE cap)\",\n    align   = c(\"c\",\"l\",\"r\",\"r\",\"r\",\"r\",\"r\",\"r\",\"r\")\n  )\n}\n\n# --- Balanced 48-month schedule ---\nif (requireNamespace(\"kableExtra\", quietly = TRUE)) {\n  scheduled_fmt %>%\n    kableExtra::kable(\n      format  = \"html\",\n      caption = \"Balanced 48-month schedule\",\n      align   = c(\"c\",\"l\",\"r\",\"r\",\"r\",\"r\",\"r\"),\n      escape  = FALSE\n    ) %>%\n    kableExtra::kable_styling(\n      full_width = FALSE,\n      bootstrap_options = c(\"striped\",\"hover\",\"condensed\")\n    )\n} else {\n  knitr::kable(\n    scheduled_fmt,\n    caption = \"Balanced 48-month schedule (sequence across four years)\",\n    align   = c(\"c\",\"l\",\"r\",\"r\",\"r\",\"r\",\"r\")\n  )\n}\n\n\n# === PLOT ===\n# --- Bloomberg-style cumulative NPV plot (final, ready to run) ---\n\n# deps\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(scales)\nlibrary(grid)\n\n# safety: build cumulative tables if not already present\nif (!exists(\"min_npv\"))        min_npv <- 50000\nif (!exists(\"scored_cum\"))     scored_cum   <- scored   %>% arrange(desc(score))   %>% mutate(cum_npv = cumsum(npv_k))\nif (!exists(\"selected_cum\"))   selected_cum <- selected %>% arrange(desc(score))   %>% mutate(cum_npv = cumsum(npv_k))\n\n# palette\ncol_all      <- \"#C7CFD9\"   # soft gray\ncol_selected <- \"#0A66C2\"   # deep blue\n\n# label data (fixed offsets; anchored to each bubble)\n# Force specific labels to the LEFT and fine-tune spacing\n# --- Bloomberg refinement: keep only first 2 words in label text ---\n\n# --- Label placement rules exactly as requested ---\n\ntop_k <- min(8, nrow(selected))\n\n# helper: first two words\nfirst_two_words <- function(s) {\n  w <- strsplit(s, \"\\\\s+\")[[1]]\n  paste(head(w, 2), collapse = \" \")\n}\nshort2 <- Vectorize(first_two_words)\n\nselected_lab_fixed <- selected_cum %>%\n  arrange(desc(score)) %>%\n  slice_head(n = top_k) %>%\n  mutate(\n    # label text: two words; SPECIAL: id 6 becomes \"Security\"\n    base_two = short2(name),\n    lbl = dplyr::case_when(\n      id == 6  ~ paste0(id, \" • Security\"),\n      TRUE     ~ paste0(id, \" • \", base_two)\n    ),\n\n    # default side by threshold\n    side_default = ifelse(cum_npv < min_npv, \"left\", \"right\"),\n\n    # OVERRIDES you requested\n    side = dplyr::case_when(\n      id %in% c(1, 17) ~ \"right\",   # 1 & 17 → right of bubble\n      id == 9          ~ \"right\",   # 9 → right (and below via y offset)\n      TRUE             ~ side_default\n    ),\n\n    # horizontal offsets (k€). 5 is centered (dx=0)\n    dx = dplyr::case_when(\n      id == 5          ~ 0,           # on top of its bubble\n      side == \"left\"   ~ -2800,\n      TRUE             ~  2400\n    ),\n\n    # vertical offsets:\n    y_lab = dplyr::case_when(\n      id == 5  ~ sustainability_tco2 + 7,   # 5 → above\n      id == 9  ~ sustainability_tco2 - 8,   # 9 → slightly below\n      TRUE     ~ sustainability_tco2\n    ),\n\n    x_lab = cum_npv + dx,\n\n    # text alignment: centered for 5; else left/right by side\n    hjust = dplyr::case_when(\n      id == 5        ~ 0.5,\n      side == \"left\" ~ 1,\n      TRUE           ~ 0\n    )\n  )\n\n\n# plot\np <- ggplot() +\n  # background: all candidates\n  geom_point(\n    data = scored_cum,\n    aes(x = cum_npv, y = sustainability_tco2, size = strategic_value),\n    color = col_all, alpha = 0.45, stroke = 0\n  ) +\n  # selected bubbles\n  geom_point(\n    data = selected_cum,\n    aes(x = cum_npv, y = sustainability_tco2, size = strategic_value),\n    shape = 21, fill = col_selected, color = \"white\", stroke = 0.9, alpha = 0.98\n  ) +\n  # leader lines bubble -> label\ngeom_segment(\n  data = selected_lab_fixed,\n  aes(x = cum_npv, y = sustainability_tco2, xend = x_lab, yend = y_lab),\n  linewidth = 0.45,                               # thicker line\n  color = scales::alpha(\"#7A869A\", 0.8),          # soft Bloomberg gray\n  lineend = \"round\"\n) +\ngeom_text(\n  data = selected_lab_fixed,\n  aes(x = x_lab, y = y_lab, label = lbl, hjust = hjust),\n  family = \"sans\", size = 3.3,\n  color = scales::alpha(\"#111111\", 0.85)\n  ) +\n  # dashed minimum cumulative NPV line (only if in range)\n  {\n    if (min_npv <= max(scored_cum$cum_npv, na.rm = TRUE)) {\n      geom_vline(xintercept = min_npv, linetype = \"dashed\", linewidth = 0.4, color = \"#7A869A\")\n    } else NULL\n  } +\n  # axes, legend, layout\n  scale_x_continuous(\n    name   = \"Cumulative NPV (k€)\",\n    labels = label_comma(accuracy = 1),\n    expand = expansion(mult = c(0.18, 0.10))\n  ) +\n  scale_y_continuous(\n    name   = \"Sustainability Impact (tCO_2e/yr)\",\n    labels = label_comma(accuracy = 1)\n  ) +\n  scale_size_continuous(\n    name   = \"Strategic Value (1–9)\",\n    breaks = c(3, 5, 7, 9),\n    range  = c(3, 14),\n    guide  = guide_legend(\n      override.aes = list(color = col_selected, fill = col_selected, alpha = 0.95),\n      title.position = \"top\"\n    )\n  ) +\n  coord_cartesian(clip = \"off\", expand = TRUE) +\n  labs(\n    title    = \"Selected as per strategic goals vs All Projects\",\n    subtitle = \"Blue = selected • Gray = all\",\n    caption  = paste(\n      \"X-axis shows cumulative NPV by score rank\",\n      \"Y-axis shows Sustainability (tCO_2e/yr)\",\n      \"Dashed line = minimum required cumulative NPV\",\n      sep = \"\\n\"\n    )\n  ) +\n  theme_minimal(base_size = 13) +\n  theme(\n    plot.title.position = \"plot\",\n    legend.position     = \"right\",\n    legend.title        = element_text(face = \"bold\"),\n    legend.key.height   = unit(12, \"pt\"),\n    legend.key.width    = unit(18, \"pt\"),\n    panel.grid.minor    = element_blank(),\n    panel.grid.major.x  = element_line(linewidth = 0.2, color = \"#E6E8EB\"),\n    panel.grid.major.y  = element_line(linewidth = 0.2, color = \"#E6E8EB\"),\n    axis.title.x        = element_text(margin = margin(t = 6)),\n    axis.title.y        = element_text(margin = margin(r = 6)),\n    plot.subtitle       = element_text(color = \"#4A4A4A\"),\n    plot.caption        = element_text(color = \"#6B7280\", size = 10)\n  )\n\np\nggsave(\"nexora_selected_portfolio_.png\", p, width = 8.5, height = 6, dpi = 320)\nggsave(\"portfolio_bloomberg_transparent.png\", p, width = 8.5, height = 6, dpi = 320, bg = \"transparent\")\n\n```\n\nWhy This Portfolio Is Optimal (Balanced Mode)\n\nEvidence-Based Efficiency: Weighted optimization (NPV 33%, Strategic 33%, Sustainability 34%) ensures each euro and FTE contributes demonstrably to Nexora’s purpose — a reflection of “what gets measured, gets managed.”\n\nStrategic Coherence: Projects like International Market, Security, and Migrate Existing Systems form the strategic backbone of transformation — high value, high decarbonization, and organizational learning effects.\n\nInclusive Impact: In our spirit, the design balances aggregate returns with distributive outcomes — creating jobs, reducing carbon intensity, and fostering digital inclusion across market layers.\n\nResource Stewardship: Operating at 189/200 FTE, the portfolio sustains ambition within administrative and fiscal realism.\n\nAdaptive Performance Culture: By linking data analytics to decision-making, Nexora advances toward a governance model that is transparent, iterative, and learning-oriented.\n\n```{r}\n# === SECOND FIGURE: Project execution sequence (Gantt-style) ===\nlibrary(ggplot2)\nsuppressWarnings(suppressMessages(requireNamespace(\"RColorBrewer\", quietly = TRUE)))\n\nif (exists(\"scheduled\") && nrow(scheduled) > 0) {\n  scheduled_gantt <- scheduled %>%\n    dplyr::arrange(start_month, dplyr::desc(score)) %>%\n    dplyr::mutate(\n      name_short  = ifelse(nchar(name) > 28, paste0(substr(name, 1, 26), \"…\"), name),\n      start_month = as.numeric(start_month),\n      end_month   = as.numeric(end_month),\n      sv_band     = as.factor(pmax(1, round(as.numeric(strategic_value))))\n    )\n\n  bands <- data.frame(\n    xstart = c(1, 13, 25, 37),\n    xend   = c(12, 24, 36, 48)\n  )\n\n  p_gantt <- ggplot() +\n    geom_rect(\n      data = bands,\n      aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = factor(xstart)),\n      alpha = 0.06, inherit.aes = FALSE\n    ) +\n    scale_fill_manual(values = c(\"#A7B1BF\", \"#FFFFFF\", \"#A7B1BF\", \"#FFFFFF\"), guide = \"none\") +\n    geom_segment(\n      data = scheduled_gantt,\n      aes(x = start_month, xend = end_month,\n          y = reorder(name_short, start_month),\n          yend = reorder(name_short, start_month),\n          color = sv_band),\n      linewidth = 4, lineend = \"round\"\n    ) +\n    geom_point(\n      data = scheduled_gantt,\n      aes(x = start_month, y = reorder(name_short, start_month), color = sv_band),\n      size = 2.4\n    ) +\n    geom_point(\n      data = scheduled_gantt,\n      aes(x = end_month, y = reorder(name_short, start_month), color = sv_band),\n      size = 2.4\n    ) +\n    geom_text(\n      data = scheduled_gantt,\n      aes(x = pmax(0.8, start_month - 0.8), y = reorder(name_short, start_month), label = id),\n      size = 3.2, hjust = 1, color = \"#2B2B2B\"\n    ) +\n    geom_vline(xintercept = c(12.5, 24.5, 36.5), color = \"#9AA4B2\", linewidth = 0.35, linetype = \"dashed\") +\n    annotate(\"text\", x = c(6.5, 18.5, 30.5, 42.5), y = Inf, vjust = 1.6,\n             label = c(\"Year 1\", \"Year 2\", \"Year 3\", \"Year 4\"),\n             size = 3.4, color = \"#4A4A4A\") +\n    scale_x_continuous(\n      breaks = seq(0, 48, by = 6),\n      limits = c(0.5, 48.5),\n      expand = expansion(mult = c(0.02, 0.02))\n    ) +\n    {\n      if (\"RColorBrewer\" %in% .packages(all.available = TRUE))\n        scale_color_brewer(palette = \"Blues\", direction = 1, name = \"Strategic Value\")\n      else\n        scale_color_discrete(name = \"Strategic Value\")\n    } +\n    labs(\n      title = \"Sequence of Project Execution (Balanced 48-month Schedule)\",\n      subtitle = \"Bars show project durations; colors indicate Strategic Value\",\n      x = \"Month\",\n      y = \"Project\"\n    ) +\n    theme_minimal(base_size = 13) +\n    theme(\n      legend.position    = \"bottom\",\n      legend.title       = element_text(face = \"bold\"),\n      panel.grid.minor   = element_blank(),\n      panel.grid.major.y = element_blank(),\n      panel.grid.major.x = element_line(linewidth = 0.25, color = \"#E5E7EB\"),\n      axis.text.y        = element_text(size = 9),\n      plot.title.position = \"plot\",\n      plot.margin        = margin(8, 24, 8, 8)\n    ) +\n    coord_cartesian(clip = \"off\")\n\n  print(p_gantt)\n  ggsave(\"portfolio_schedule_gantt.png\", p_gantt, width = 9.5, height = 5.2, dpi = 320)\n}\n\n\n```\n\n```{r}\n# === Mutual Exclusivity Diagnostic (Refined Styling) ===\nif (!requireNamespace(\"corrplot\", quietly = TRUE)) {\n  install.packages(\"corrplot\")\n}\n\n# suppress startup messages globally\nsuppressPackageStartupMessages({\n  library(corrplot)\n})\n\nlibrary(corrplot)\n\ncorr_mat <- selected %>%\n  dplyr::select(npv_k, strategic_value, sustainability_tco2, workforce_fte, motivation) %>%\n  cor(use = \"complete.obs\")\n\n# refined plot aesthetics\ncorrplot::corrplot(\n  corr_mat,\n  method = \"color\",\n  type = \"upper\",               # show only upper triangle (cleaner)\n  order = \"hclust\",             # cluster similar variables\n  addCoef.col = \"black\",        # show numeric values\n  number.cex = 0.7,             # coefficient text size\n  tl.col = \"black\",             # variable label color\n  tl.srt = 30,                  # tilt variable names\n  tl.cex = 0.9,                 # smaller text\n  col = colorRampPalette(c(\"#B91C1C\", \"#F3F4F6\", \"#15803D\"))(200),  # red-white-green palette\n  mar = c(0, 0, 3, 0),          # add top margin\n  title = \"Correlation Matrix — Selected Portfolio Attributes\"\n)\n\n\n```\n\nThis portfolio transforms Nexora’s strategy into a verifiable system of performance. Quantitative evidence confirms that the organization’s priorities — value creation, sustainable growth, and human motivation — coexist in equilibrium rather than in tension.\n\nThe moderate correlations indicate that projects are non-redundant yet synergistic; the over-achievement on NPV and Strategic Value shows collective coverage of the strategic space. Together, these findings validate that Nexora’s investments are neither fragmented nor overstretched, but structurally aligned with its long-term mission of sustainable innovation and responsible profitability.\n\nIn sum, the portfolio stands as a living demonstration of evidence-based strategy: measurable, balanced, and grounded in both analytical rigor and pragmatic feasibility.\n","srcMarkdownNoYaml":"\n\n\n\n```{r}\n# === SETUP ===\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(knitr)\nlibrary(ggrepel)\nlibrary(kableExtra)\n\n\n# Load data ---------------------------------------------------------------\ncsv_path <- \"projects.csv\"\nstopifnot(file.exists(csv_path))\n\nprojects <- read_csv(csv_path, show_col_types = FALSE)\nnames(projects) <- tolower(names(projects))\n\n# Verify required columns\nreq <- c(\"id\",\"name\",\"npv_k\",\"strategic_value\",\n         \"sustainability_tco2\",\"workforce_fte\",\"motivation\",\"duration_years\")\nstopifnot(all(req %in% names(projects)))\n\n# Rename duration_years -> duration_months (task values are in months)\nprojects <- projects %>%\n  rename(duration_months = duration_years) %>%\n  mutate(across(c(npv_k, strategic_value, sustainability_tco2,\n                  workforce_fte, motivation, duration_months), as.numeric))\n\n# === FUNCTIONS ===\n\n# --- Scoring -------------------------------------------------------------\nscore_projects <- function(df, mode = c(\"balanced\",\"growth\",\"responsible\")) {\n  mode <- match.arg(mode)\n  rng <- function(x) (x - min(x)) / (max(x) - min(x) + 1e-9)\n  x <- df %>%\n    mutate(\n      npv_n = rng(npv_k),\n      sv_n  = rng(strategic_value),\n      sus_n = rng(sustainability_tco2),\n      mot_n = rng(motivation),\n      fte_n = rng(workforce_fte)\n    )\n  x$score <- switch(\n    mode,\n    balanced    = 0.33 * x$npv_n + 0.33 * x$sv_n + 0.34 * x$sus_n + 0.05 * x$mot_n - 0.05 * x$fte_n,\n    growth      = 0.65 * x$npv_n + 0.20 * x$sus_n + 0.15 * x$sv_n + 0.02 * x$mot_n - 0.02 * x$fte_n,\n    responsible = 0.55 * x$sus_n + 0.25 * x$mot_n + 0.20 * x$sv_n - 0.05 * x$fte_n + 0.05 * x$npv_n\n  )\n  x %>% arrange(desc(score))\n}\n\n# --- Selection (greedy) --------------------------------------------------\nbuild_portfolio <- function(df_scored, min_npv, min_sv, cap_total_fte = NA) {\n  cand <- df_scored %>% arrange(desc(score)) %>% mutate(selected = FALSE)\n  tot <- c(npv=0, sv=0, sus=0, fte=0)\n\n  for (i in seq_len(nrow(cand))) {\n    fits <- is.na(cap_total_fte) || (tot[\"fte\"] + cand$workforce_fte[i] <= cap_total_fte)\n    if (fits) {\n      cand$selected[i] <- TRUE\n      tot[\"npv\"] <- tot[\"npv\"] + cand$npv_k[i]\n      tot[\"sv\"]  <- tot[\"sv\"]  + cand$strategic_value[i]\n      tot[\"sus\"] <- tot[\"sus\"] + cand$sustainability_tco2[i]\n      tot[\"fte\"] <- tot[\"fte\"] + cand$workforce_fte[i]\n    }\n  }\n\n  list(\n    selection = cand %>% filter(selected),\n    totals = list(\n      npv = sum(cand$npv_k[cand$selected]),\n      sv  = sum(cand$strategic_value[cand$selected]),\n      sus = sum(cand$sustainability_tco2[cand$selected]),\n      fte = sum(cand$workforce_fte[cand$selected])\n    )\n  )\n}\n\n# --- Balanced 48-Month Scheduler: smooths Strategic Intensity & FTE ---\nschedule_48m <- function(sel_df, cap_monthly_fte = NA, w_sv = 0.7, w_fte = 0.3) {\n  if (nrow(sel_df) == 0) return(sel_df %>% mutate(start_month = integer(), end_month = integer()))\n  # work copies\n  plan <- sel_df %>%\n    arrange(desc(score)) %>%            # higher score first\n    mutate(start_month = NA_integer_, end_month = NA_integer_)\n  used_fte <- rep(0, 48)\n  used_sv  <- rep(0, 48)\n\n  for (i in seq_len(nrow(plan))) {\n    dur <- max(1, round(plan$duration_months[i]))\n    fte <- plan$workforce_fte[i]\n    sv  <- plan$strategic_value[i]\n\n    # Try all feasible start months; pick the one that best smooths (min variance)\n    best_cost <- Inf\n    best_start <- NA_integer_\n\n    for (start in 1:(48 - dur + 1)) {\n      idx <- start:(start + dur - 1)\n\n      # capacity feasibility\n      feasible <- all(is.na(cap_monthly_fte) | (used_fte[idx] + fte) <= cap_monthly_fte)\n      if (!feasible) next\n\n      # simulate placement\n      new_fte <- used_fte; new_fte[idx] <- new_fte[idx] + fte\n      new_sv  <- used_sv;  new_sv[idx]  <- new_sv[idx]  + sv\n\n      # objective: weighted sum of monthly variability\n      cost <- w_sv * stats::sd(new_sv) + w_fte * stats::sd(new_fte)\n\n      if (cost < best_cost) { best_cost <- cost; best_start <- start }\n    }\n\n    # if nothing feasible (rare), push to the end within 48m\n    if (is.na(best_start)) best_start <- max(1, 49 - dur)\n\n    # commit placement\n    idx <- best_start:(best_start + dur - 1)\n    used_fte[idx] <- used_fte[idx] + fte\n    used_sv[idx]  <- used_sv[idx]  + sv\n    plan$start_month[i] <- best_start\n    plan$end_month[i]   <- best_start + dur - 1\n  }\n\n  plan\n}\n\n\n# === RUN MODEL ===\nmode      <- \"balanced\"        # choose: balanced | growth | responsible\nmin_npv   <- 50000             # minimum NPV threshold (k€)\nmin_sv    <- 80                # minimum Strategic Value\ncap_total <- 200               # total FTE capacity\ncap_month <- NA                # monthly cap (optional)\n\nscored    <- score_projects(projects, mode)\npicked    <- build_portfolio(scored, min_npv, min_sv, cap_total)\nselected  <- picked$selection\ntotals    <- picked$totals\n\n\nmeets  <- (totals$npv >= min_npv) & (totals$sv >= min_sv)\nstatus <- if (meets) \"Meets thresholds\" else \"⚠️ Below thresholds\"\n\nif (FALSE) {\ncat(\"**Strategy:**\", mode, \"\\n\",\n    \"**Min NPV (k€):**\", min_npv, \"\\n\",\n    \"**Min Strategic Value:**\", min_sv, \"\\n\",\n    \"**Total FTE cap:**\", ifelse(is.na(cap_total), \"∞\", cap_total), \"\\n\",\n    \"**Monthly FTE cap:**\", ifelse(is.na(cap_month), \"—\", cap_month), \"\\n\",\n    \"**Status:**\", status, \"\\n\\n\")\n\nkable(\n  tibble::tibble(\n    Metric = c(\"NPV (k€)\",\"Strategic Value (sum)\",\n               \"Sustainability (tCO2e/yr)\",\"FTE (sum)\"),\n    Value  = c(totals$npv, totals$sv, totals$sus, totals$fte)\n  ),\n  caption = \"Portfolio totals\"\n)\n}\n# --- PLAN A: lift Strategic Value to >= min_sv ---\nif (totals$sv < min_sv) {\n  fix_drop <- intersect(c(20), selected$id)\n  fix_add  <- setdiff(intersect(c(2, 4), scored$id), selected$id)\n\n  selected <- selected %>%\n    dplyr::filter(!id %in% fix_drop) %>%\n    dplyr::bind_rows(scored %>% dplyr::filter(id %in% fix_add)) %>%\n    dplyr::distinct(id, .keep_all = TRUE) %>%\n    dplyr::arrange(dplyr::desc(score))\n\n  totals <- list(\n    npv = sum(selected$npv_k, na.rm = TRUE),\n    sv  = sum(selected$strategic_value, na.rm = TRUE),\n    sus = sum(selected$sustainability_tco2, na.rm = TRUE),\n    fte = sum(selected$workforce_fte, na.rm = TRUE)\n  )\n\n  # old text output disabled (kept for debugging if needed)\n  if (FALSE) {\n    cat(\"\\n--- After Scenario A (applied) ---\\n\",\n        \"Selected projects: \", nrow(selected), \"\\n\",\n        \"Total NPV (k€):   \", totals$npv, \" | target ≥ \", min_npv, \"\\n\",\n        \"Strategic Value Σ:\", totals$sv,  \" | target ≥ \", min_sv,  \"\\n\",\n        \"Sustainability Σ: \", totals$sus, \" (tCO2e/yr)\\n\",\n        \"Total FTE Σ:      \", totals$fte, \" | cap = \", cap_total, \"\\n\\n\", sep = \"\")\n  }\n}  # <-- this was missing\n\n\n# Build the table sources AFTER Scenario A (so they stay in sync)\nsel_tbl <- selected %>%\n  dplyr::select(\n    id, name, npv_k, strategic_value, sustainability_tco2,\n    workforce_fte, motivation, duration_months, score\n  )\n\ntot_row <- tibble::tibble(\n  id = NA_integer_,\n  name = \"TOTAL\",\n  npv_k = sum(selected$npv_k, na.rm = TRUE),\n  strategic_value = sum(selected$strategic_value, na.rm = TRUE),\n  sustainability_tco2 = sum(selected$sustainability_tco2, na.rm = TRUE),\n  workforce_fte = sum(selected$workforce_fte, na.rm = TRUE),\n  motivation = NA_real_,\n  duration_months = NA_real_,\n  score = NA_real_\n)\n\n# Create the 48-month schedule BEFORE any tables/plots that use it\nscheduled <- schedule_48m(selected, cap_month)\n# Create (or re-create) the 48-month schedule BEFORE any tables/plots\nif (!exists(\"scheduled\")) scheduled <- schedule_48m(selected, cap_month)\n\n\n# === Scenario summary table (nice formatting; kableExtra-safe) ===\npass_npv <- totals$npv >= min_npv\npass_sv  <- totals$sv  >= min_sv\npass_fte <- is.na(cap_total) || totals$fte <= cap_total\n\nscenario_tbl <- tibble::tibble(\n  Metric = c(\n    \"Selected projects\",\n    \"Total NPV (k€)\",\n    \"Strategic Value Σ\",\n    \"Sustainability Σ (tCO₂e/yr)\",\n    \"Total FTE Σ\"\n  ),\n  Value = c(\n    nrow(selected),\n    scales::comma(totals$npv),\n    scales::comma(totals$sv),\n    scales::comma(totals$sus),\n    scales::comma(totals$fte)\n  ),\n  Target = c(\n    \"—\",\n    paste0(\"≥ \", scales::comma(min_npv)),\n    paste0(\"≥ \", min_sv),\n    \"—\",\n    if (!is.na(cap_total)) paste0(\"≤ \", scales::comma(cap_total)) else \"—\"\n  ),\n  Status = c(\n    \"—\",\n    if (pass_npv) \"Meets\" else \"⚠️ Below\",\n    if (pass_sv)  \"Meets\" else \"⚠️ Below\",\n    \"—\",\n    if (pass_fte) \"Within\" else \"⚠️ Exceeds\"\n  )\n)\n\nif (requireNamespace(\"kableExtra\", quietly = TRUE)) {\n  badge_css <- \"padding:2px 8px;border-radius:12px;display:inline-block;\"\n\n  scenario_tbl_print <- scenario_tbl %>%\n    dplyr::mutate(\n      Status = dplyr::case_when(\n        Metric %in% c(\"Total NPV (k€)\", \"Strategic Value Σ\", \"Total FTE Σ\") & grepl(\"✅\", Status) ~\n          kableExtra::cell_spec(Status, \"html\", color = \"white\", bold = TRUE,\n                                background = \"#16a34a\", extra_css = badge_css),\n        Metric %in% c(\"Total NPV (k€)\", \"Strategic Value Σ\", \"Total FTE Σ\") & grepl(\"⚠️\", Status) ~\n          kableExtra::cell_spec(Status, \"html\", color = \"white\", bold = TRUE,\n                                background = \"#dc2626\", extra_css = badge_css),\n        TRUE ~ Status\n      )\n    )\n\n  scenario_tbl_print %>%\n    kableExtra::kable(\n      format  = \"html\",\n      caption = \"Scenario Summary — After Scenario A (applied)\",\n      align   = c(\"l\",\"r\",\"c\",\"c\"),\n      escape  = FALSE\n    ) %>%\n    kableExtra::kable_styling(\n      full_width = FALSE,\n      bootstrap_options = c(\"striped\",\"condensed\")\n    ) %>%\n    kableExtra::column_spec(1, bold = TRUE) %>%\n    kableExtra::column_spec(2, width = \"8em\", monospace = TRUE) %>%\n    kableExtra::column_spec(3, width = \"8em\", monospace = TRUE) %>%\n    kableExtra::column_spec(4, width = \"7em\") %>%\n    kableExtra::row_spec(1, background = \"#F8FAFC\")\n} else {\n  knitr::kable(\n    scenario_tbl,\n    caption = \"Scenario Summary — After Scenario A (applied)\",\n    align   = c(\"l\",\"r\",\"c\",\"c\")\n  )\n}\n\n\n\n\n# === TABLES (selected with TOTAL row + balanced 48-month schedule) ===\nlibrary(scales)\nlibrary(kableExtra)\n\n# 1 Format the data (keep this part unchanged)\nsel_tbl_fmt <- dplyr::bind_rows(sel_tbl, tot_row) %>%\n  dplyr::mutate(\n    npv_k               = scales::label_comma(accuracy = 1)(as.numeric(npv_k)),\n    strategic_value     = as.character(strategic_value),\n    sustainability_tco2 = scales::label_comma(accuracy = 1)(as.numeric(sustainability_tco2)),\n    workforce_fte       = scales::label_comma(accuracy = 1)(as.numeric(workforce_fte)),\n    motivation          = dplyr::if_else(is.na(motivation), \"\", as.character(round(motivation, 2))),\n    duration_months     = dplyr::if_else(is.na(duration_months), \"\", as.character(round(duration_months, 0))),\n    score               = dplyr::if_else(is.na(score), \"\", as.character(round(score, 3)))\n  )\n\nif (exists(\"scheduled\") && is.data.frame(scheduled) && nrow(scheduled) > 0) {\n  scheduled_fmt <- scheduled %>%\n    dplyr::arrange(start_month, dplyr::desc(score)) %>%\n    dplyr::select(id, name, strategic_value, workforce_fte,\n                  duration_months, start_month, end_month) %>%\n    dplyr::mutate(\n      workforce_fte   = scales::label_comma(accuracy = 1)(as.numeric(workforce_fte)),\n      duration_months = round(as.numeric(duration_months), 0),\n      start_month     = round(as.numeric(start_month), 0),\n      end_month       = round(as.numeric(end_month), 0)\n    )\n} else {\n  scheduled_fmt <- tibble::tibble(\n    id=integer(), name=character(), strategic_value=numeric(),\n    workforce_fte=numeric(), duration_months=integer(),\n    start_month=integer(), end_month=integer()\n  )\n}\n\n\n# 2 Then render the formatted tables (new styling section)\n# --- Selected portfolio (with TOTAL row) ---\nif (requireNamespace(\"kableExtra\", quietly = TRUE)) {\n  sel_tbl_fmt %>%\n    kableExtra::kable(\n      format  = \"html\",\n      caption = \"Selected portfolio (within FTE cap)\",\n      align   = c(\"c\",\"l\",\"r\",\"r\",\"r\",\"r\",\"r\",\"r\",\"r\"),\n      escape  = FALSE\n    ) %>%\n    kableExtra::kable_styling(\n      full_width = FALSE,\n      bootstrap_options = c(\"striped\",\"hover\",\"condensed\")\n    ) %>%\n    kableExtra::row_spec(nrow(sel_tbl_fmt), bold = TRUE)\n} else {\n  knitr::kable(\n    sel_tbl_fmt,\n    caption = \"Selected portfolio (within FTE cap)\",\n    align   = c(\"c\",\"l\",\"r\",\"r\",\"r\",\"r\",\"r\",\"r\",\"r\")\n  )\n}\n\n# --- Balanced 48-month schedule ---\nif (requireNamespace(\"kableExtra\", quietly = TRUE)) {\n  scheduled_fmt %>%\n    kableExtra::kable(\n      format  = \"html\",\n      caption = \"Balanced 48-month schedule\",\n      align   = c(\"c\",\"l\",\"r\",\"r\",\"r\",\"r\",\"r\"),\n      escape  = FALSE\n    ) %>%\n    kableExtra::kable_styling(\n      full_width = FALSE,\n      bootstrap_options = c(\"striped\",\"hover\",\"condensed\")\n    )\n} else {\n  knitr::kable(\n    scheduled_fmt,\n    caption = \"Balanced 48-month schedule (sequence across four years)\",\n    align   = c(\"c\",\"l\",\"r\",\"r\",\"r\",\"r\",\"r\")\n  )\n}\n\n\n# === PLOT ===\n# --- Bloomberg-style cumulative NPV plot (final, ready to run) ---\n\n# deps\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(scales)\nlibrary(grid)\n\n# safety: build cumulative tables if not already present\nif (!exists(\"min_npv\"))        min_npv <- 50000\nif (!exists(\"scored_cum\"))     scored_cum   <- scored   %>% arrange(desc(score))   %>% mutate(cum_npv = cumsum(npv_k))\nif (!exists(\"selected_cum\"))   selected_cum <- selected %>% arrange(desc(score))   %>% mutate(cum_npv = cumsum(npv_k))\n\n# palette\ncol_all      <- \"#C7CFD9\"   # soft gray\ncol_selected <- \"#0A66C2\"   # deep blue\n\n# label data (fixed offsets; anchored to each bubble)\n# Force specific labels to the LEFT and fine-tune spacing\n# --- Bloomberg refinement: keep only first 2 words in label text ---\n\n# --- Label placement rules exactly as requested ---\n\ntop_k <- min(8, nrow(selected))\n\n# helper: first two words\nfirst_two_words <- function(s) {\n  w <- strsplit(s, \"\\\\s+\")[[1]]\n  paste(head(w, 2), collapse = \" \")\n}\nshort2 <- Vectorize(first_two_words)\n\nselected_lab_fixed <- selected_cum %>%\n  arrange(desc(score)) %>%\n  slice_head(n = top_k) %>%\n  mutate(\n    # label text: two words; SPECIAL: id 6 becomes \"Security\"\n    base_two = short2(name),\n    lbl = dplyr::case_when(\n      id == 6  ~ paste0(id, \" • Security\"),\n      TRUE     ~ paste0(id, \" • \", base_two)\n    ),\n\n    # default side by threshold\n    side_default = ifelse(cum_npv < min_npv, \"left\", \"right\"),\n\n    # OVERRIDES you requested\n    side = dplyr::case_when(\n      id %in% c(1, 17) ~ \"right\",   # 1 & 17 → right of bubble\n      id == 9          ~ \"right\",   # 9 → right (and below via y offset)\n      TRUE             ~ side_default\n    ),\n\n    # horizontal offsets (k€). 5 is centered (dx=0)\n    dx = dplyr::case_when(\n      id == 5          ~ 0,           # on top of its bubble\n      side == \"left\"   ~ -2800,\n      TRUE             ~  2400\n    ),\n\n    # vertical offsets:\n    y_lab = dplyr::case_when(\n      id == 5  ~ sustainability_tco2 + 7,   # 5 → above\n      id == 9  ~ sustainability_tco2 - 8,   # 9 → slightly below\n      TRUE     ~ sustainability_tco2\n    ),\n\n    x_lab = cum_npv + dx,\n\n    # text alignment: centered for 5; else left/right by side\n    hjust = dplyr::case_when(\n      id == 5        ~ 0.5,\n      side == \"left\" ~ 1,\n      TRUE           ~ 0\n    )\n  )\n\n\n# plot\np <- ggplot() +\n  # background: all candidates\n  geom_point(\n    data = scored_cum,\n    aes(x = cum_npv, y = sustainability_tco2, size = strategic_value),\n    color = col_all, alpha = 0.45, stroke = 0\n  ) +\n  # selected bubbles\n  geom_point(\n    data = selected_cum,\n    aes(x = cum_npv, y = sustainability_tco2, size = strategic_value),\n    shape = 21, fill = col_selected, color = \"white\", stroke = 0.9, alpha = 0.98\n  ) +\n  # leader lines bubble -> label\ngeom_segment(\n  data = selected_lab_fixed,\n  aes(x = cum_npv, y = sustainability_tco2, xend = x_lab, yend = y_lab),\n  linewidth = 0.45,                               # thicker line\n  color = scales::alpha(\"#7A869A\", 0.8),          # soft Bloomberg gray\n  lineend = \"round\"\n) +\ngeom_text(\n  data = selected_lab_fixed,\n  aes(x = x_lab, y = y_lab, label = lbl, hjust = hjust),\n  family = \"sans\", size = 3.3,\n  color = scales::alpha(\"#111111\", 0.85)\n  ) +\n  # dashed minimum cumulative NPV line (only if in range)\n  {\n    if (min_npv <= max(scored_cum$cum_npv, na.rm = TRUE)) {\n      geom_vline(xintercept = min_npv, linetype = \"dashed\", linewidth = 0.4, color = \"#7A869A\")\n    } else NULL\n  } +\n  # axes, legend, layout\n  scale_x_continuous(\n    name   = \"Cumulative NPV (k€)\",\n    labels = label_comma(accuracy = 1),\n    expand = expansion(mult = c(0.18, 0.10))\n  ) +\n  scale_y_continuous(\n    name   = \"Sustainability Impact (tCO_2e/yr)\",\n    labels = label_comma(accuracy = 1)\n  ) +\n  scale_size_continuous(\n    name   = \"Strategic Value (1–9)\",\n    breaks = c(3, 5, 7, 9),\n    range  = c(3, 14),\n    guide  = guide_legend(\n      override.aes = list(color = col_selected, fill = col_selected, alpha = 0.95),\n      title.position = \"top\"\n    )\n  ) +\n  coord_cartesian(clip = \"off\", expand = TRUE) +\n  labs(\n    title    = \"Selected as per strategic goals vs All Projects\",\n    subtitle = \"Blue = selected • Gray = all\",\n    caption  = paste(\n      \"X-axis shows cumulative NPV by score rank\",\n      \"Y-axis shows Sustainability (tCO_2e/yr)\",\n      \"Dashed line = minimum required cumulative NPV\",\n      sep = \"\\n\"\n    )\n  ) +\n  theme_minimal(base_size = 13) +\n  theme(\n    plot.title.position = \"plot\",\n    legend.position     = \"right\",\n    legend.title        = element_text(face = \"bold\"),\n    legend.key.height   = unit(12, \"pt\"),\n    legend.key.width    = unit(18, \"pt\"),\n    panel.grid.minor    = element_blank(),\n    panel.grid.major.x  = element_line(linewidth = 0.2, color = \"#E6E8EB\"),\n    panel.grid.major.y  = element_line(linewidth = 0.2, color = \"#E6E8EB\"),\n    axis.title.x        = element_text(margin = margin(t = 6)),\n    axis.title.y        = element_text(margin = margin(r = 6)),\n    plot.subtitle       = element_text(color = \"#4A4A4A\"),\n    plot.caption        = element_text(color = \"#6B7280\", size = 10)\n  )\n\np\nggsave(\"nexora_selected_portfolio_.png\", p, width = 8.5, height = 6, dpi = 320)\nggsave(\"portfolio_bloomberg_transparent.png\", p, width = 8.5, height = 6, dpi = 320, bg = \"transparent\")\n\n```\n\nWhy This Portfolio Is Optimal (Balanced Mode)\n\nEvidence-Based Efficiency: Weighted optimization (NPV 33%, Strategic 33%, Sustainability 34%) ensures each euro and FTE contributes demonstrably to Nexora’s purpose — a reflection of “what gets measured, gets managed.”\n\nStrategic Coherence: Projects like International Market, Security, and Migrate Existing Systems form the strategic backbone of transformation — high value, high decarbonization, and organizational learning effects.\n\nInclusive Impact: In our spirit, the design balances aggregate returns with distributive outcomes — creating jobs, reducing carbon intensity, and fostering digital inclusion across market layers.\n\nResource Stewardship: Operating at 189/200 FTE, the portfolio sustains ambition within administrative and fiscal realism.\n\nAdaptive Performance Culture: By linking data analytics to decision-making, Nexora advances toward a governance model that is transparent, iterative, and learning-oriented.\n\n```{r}\n# === SECOND FIGURE: Project execution sequence (Gantt-style) ===\nlibrary(ggplot2)\nsuppressWarnings(suppressMessages(requireNamespace(\"RColorBrewer\", quietly = TRUE)))\n\nif (exists(\"scheduled\") && nrow(scheduled) > 0) {\n  scheduled_gantt <- scheduled %>%\n    dplyr::arrange(start_month, dplyr::desc(score)) %>%\n    dplyr::mutate(\n      name_short  = ifelse(nchar(name) > 28, paste0(substr(name, 1, 26), \"…\"), name),\n      start_month = as.numeric(start_month),\n      end_month   = as.numeric(end_month),\n      sv_band     = as.factor(pmax(1, round(as.numeric(strategic_value))))\n    )\n\n  bands <- data.frame(\n    xstart = c(1, 13, 25, 37),\n    xend   = c(12, 24, 36, 48)\n  )\n\n  p_gantt <- ggplot() +\n    geom_rect(\n      data = bands,\n      aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = factor(xstart)),\n      alpha = 0.06, inherit.aes = FALSE\n    ) +\n    scale_fill_manual(values = c(\"#A7B1BF\", \"#FFFFFF\", \"#A7B1BF\", \"#FFFFFF\"), guide = \"none\") +\n    geom_segment(\n      data = scheduled_gantt,\n      aes(x = start_month, xend = end_month,\n          y = reorder(name_short, start_month),\n          yend = reorder(name_short, start_month),\n          color = sv_band),\n      linewidth = 4, lineend = \"round\"\n    ) +\n    geom_point(\n      data = scheduled_gantt,\n      aes(x = start_month, y = reorder(name_short, start_month), color = sv_band),\n      size = 2.4\n    ) +\n    geom_point(\n      data = scheduled_gantt,\n      aes(x = end_month, y = reorder(name_short, start_month), color = sv_band),\n      size = 2.4\n    ) +\n    geom_text(\n      data = scheduled_gantt,\n      aes(x = pmax(0.8, start_month - 0.8), y = reorder(name_short, start_month), label = id),\n      size = 3.2, hjust = 1, color = \"#2B2B2B\"\n    ) +\n    geom_vline(xintercept = c(12.5, 24.5, 36.5), color = \"#9AA4B2\", linewidth = 0.35, linetype = \"dashed\") +\n    annotate(\"text\", x = c(6.5, 18.5, 30.5, 42.5), y = Inf, vjust = 1.6,\n             label = c(\"Year 1\", \"Year 2\", \"Year 3\", \"Year 4\"),\n             size = 3.4, color = \"#4A4A4A\") +\n    scale_x_continuous(\n      breaks = seq(0, 48, by = 6),\n      limits = c(0.5, 48.5),\n      expand = expansion(mult = c(0.02, 0.02))\n    ) +\n    {\n      if (\"RColorBrewer\" %in% .packages(all.available = TRUE))\n        scale_color_brewer(palette = \"Blues\", direction = 1, name = \"Strategic Value\")\n      else\n        scale_color_discrete(name = \"Strategic Value\")\n    } +\n    labs(\n      title = \"Sequence of Project Execution (Balanced 48-month Schedule)\",\n      subtitle = \"Bars show project durations; colors indicate Strategic Value\",\n      x = \"Month\",\n      y = \"Project\"\n    ) +\n    theme_minimal(base_size = 13) +\n    theme(\n      legend.position    = \"bottom\",\n      legend.title       = element_text(face = \"bold\"),\n      panel.grid.minor   = element_blank(),\n      panel.grid.major.y = element_blank(),\n      panel.grid.major.x = element_line(linewidth = 0.25, color = \"#E5E7EB\"),\n      axis.text.y        = element_text(size = 9),\n      plot.title.position = \"plot\",\n      plot.margin        = margin(8, 24, 8, 8)\n    ) +\n    coord_cartesian(clip = \"off\")\n\n  print(p_gantt)\n  ggsave(\"portfolio_schedule_gantt.png\", p_gantt, width = 9.5, height = 5.2, dpi = 320)\n}\n\n\n```\n\n```{r}\n# === Mutual Exclusivity Diagnostic (Refined Styling) ===\nif (!requireNamespace(\"corrplot\", quietly = TRUE)) {\n  install.packages(\"corrplot\")\n}\n\n# suppress startup messages globally\nsuppressPackageStartupMessages({\n  library(corrplot)\n})\n\nlibrary(corrplot)\n\ncorr_mat <- selected %>%\n  dplyr::select(npv_k, strategic_value, sustainability_tco2, workforce_fte, motivation) %>%\n  cor(use = \"complete.obs\")\n\n# refined plot aesthetics\ncorrplot::corrplot(\n  corr_mat,\n  method = \"color\",\n  type = \"upper\",               # show only upper triangle (cleaner)\n  order = \"hclust\",             # cluster similar variables\n  addCoef.col = \"black\",        # show numeric values\n  number.cex = 0.7,             # coefficient text size\n  tl.col = \"black\",             # variable label color\n  tl.srt = 30,                  # tilt variable names\n  tl.cex = 0.9,                 # smaller text\n  col = colorRampPalette(c(\"#B91C1C\", \"#F3F4F6\", \"#15803D\"))(200),  # red-white-green palette\n  mar = c(0, 0, 3, 0),          # add top margin\n  title = \"Correlation Matrix — Selected Portfolio Attributes\"\n)\n\n\n```\n\nThis portfolio transforms Nexora’s strategy into a verifiable system of performance. Quantitative evidence confirms that the organization’s priorities — value creation, sustainable growth, and human motivation — coexist in equilibrium rather than in tension.\n\nThe moderate correlations indicate that projects are non-redundant yet synergistic; the over-achievement on NPV and Strategic Value shows collective coverage of the strategic space. Together, these findings validate that Nexora’s investments are neither fragmented nor overstretched, but structurally aligned with its long-term mission of sustainable innovation and responsible profitability.\n\nIn sum, the portfolio stands as a living demonstration of evidence-based strategy: measurable, balanced, and grounded in both analytical rigor and pragmatic feasibility.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":9,"fig-height":6,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":false,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"center","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"number-sections":false,"dpi":220,"css":["assets/bloomberg.css"],"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","theme":{"light":"flatly","dark":"darkly"},"toc-title":"On this page","page-layout":"full","fig-cap-location":"margin","anchor-sections":true,"title":"Nexora: 4-Year Portfolio Selection & Schedule","author":"Oleksandr Skytchenko","date":"today","smooth-scroll":true},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}